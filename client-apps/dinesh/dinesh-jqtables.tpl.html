<!-- 
Files Needed are jquery and jquery-datatables.min.js 
https://datatables.net/examples/
https://datatables.net/search/?cx=004673356914326163298%3Abcgejkcchl4&cof=FORID%3A9&ie=UTF-8&q=checkbox&sa=Search&siteurl=datatables.net%2Fforums%2Fdiscussions%2Fp3&ref=datatables.net%2Fforums%2Fdiscussions%2Fp2&ss=1096j195992j9
https://datatables.net/forums/discussion/6682/getting-the-checked-check-box-row-values
-->
<!-- Markup -->
<div class="container">    
    <div class="row">
        <div class="col-md-3">
            <div class="panel panel-default"> <!-- PaneL Starting.. -->
                <div class="panel-heading">
                    <h3 class="panel-title">Search Recreate:</h3>
                </div>
                <div class="panel-body">
                    <form method="GET" action="" id="providersearch" enctype="multipart/form-data" class="form-horizontal">
                        <div id="errorMsg" style="display:none;"><p class="error"></p></div>
                        <div class="form-group">
                            <label for="recreateContractNumber" class="col-md-6 control-label">Contract No</label>
                            <div class="col-md-6"><input type="text" class="form-control input-sm" id="recreateContractNumber" placeholder="ContractNumber"></div>
                        </div>
                
                        <div class="form-group">
                            <label for="eobRecreatePlanBenefitPackage" class="col-md-6 control-label">Plan Benefit</label>
                            <div class="col-md-6"><input type="text" class="form-control input-sm" id="eobRecreatePlanBenefitPackage" placeholder="eobRecreatePlanBenefitPackage"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="eobRecreateMbrNo" class="col-md-6 control-label">Master Group</label>
                            <div class="col-md-6"><input type="text" class="form-control input-sm" id="eobRecreateMbrNo" placeholder="eobRecreateMbrNo"></div>
                        </div>
                        <div class="form-group">
                            <label for="eobRecreateMbrNo" class="col-md-6 control-label">Rpt Prd End Date</label>
                            <div class="col-md-6"><input type="text" class="form-control input-sm" id="eobRecreateReportingPeriodEndDate" placeholder="eobRecreateReportingPeriodEndDate"></div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-5 col-sm-5"><button type="submit" class="btn btn-default" id="eobRecreateSearchBtn" name="eobRecreateSearchBtn">Search</button></div>
                        </div>
                    </form>
                </div>
            </div> <!-- END: Panel --> 
        </div><!-- col-md-3 -->
        <div class="col-md-9">
            <div id ="eobRecreateDetailsContainer" class="table-responsive" style="display:block;">
            
            <table id ="eobRecreateResultTab" class="table table-hover display">
            <caption>Hover Table Layout</caption>    
            <thead>
                <tr>
                    <td>Test</td>    
                    <td>Contract Number</td>
                    <td>Plan Benefit Package</td>
                    <td>Master Group Number</td>
                    <td>Medical Member ID #</td>
                    <td>Reporting Period End Date</td>
                    <td>Select / Unselect<input type="checkbox" name="cbox" id="selectall1"/></td>
                </tr>
            </thead>
            <tbody></tbody>
            </table>

            </div>
        </div><!-- END: Col-md-9 -->
        <!-- <div id="tablejson"></div> -->
    </div><!-- Row Ends here -->
    <!-- BUTON STARTS HERE-->
    <div id="button_row" class="form_row" style="float:right;padding:7px 7px 7px 0px;">
    <div class="form_leftcol">
        <input type="button"  value="Check Me" onclick="postMethodss()"/>
        <input class="form_button_submit ui-button ui-widget ui-state-default ui-corner-all" type="button" id="addNewButton" value="Submit Re-Create Request" onclick="SubmitRecreateRequest()" />
    </div>
    </div>

    <!-- BUTTONS ENDS.. -->
    <!-- Details row Starts here -->
    <div class="row">
        <div class="col-md-12">
            <div id ="eob-recreate-details" class="table-responsive">
            <table id ="eobRecreateDetailsTab" class="table table-hover display">
            <caption>Hover Table Layout</caption>    
            <thead>
                <tr>
                    <td>Subscriber Release Id</td>
                    <td>Subscriber Name</td>
                    <td>Member Medical #</td>
                    <td>Member Medical Source System</td>
                    <td>Master Group Number</td>
                    <td>Group Number</td>
                    <td>Division Site</td>
                    <td>Contract Number</td>
                    <td>Plan Benifit Package</td>
                    <td>Plan Contract Year</td>
                    <td>Reporting End Date</td>
                    <td>EOB Release Date</td>
                    <td>Eligibility Source</td>
                    <td>Subscriber DOB</td>
                    <td>Has Claim Indicator</td>
                    <td>Recreate Indicator</td>
                    <td>Subscriber Hold</td>
                </tr>
            </thead>
            <tbody></tbody>
            </table>    
            </div>
        </div>
        
    </div>    <!--  END: Details Row Ends here -->
    
</div> <!-- Container.. -->

<!-- Below js is specific to this page, So included in the page.. -->

<script type="text/javascript">
// ##### Search section #####
var eobRecreateSearch = {
    search:function(){
         var requestJSON = {
            "contractNbr": jQuery('#eobRecreateContractNumber').val(),
            "planBenefitPackage": jQuery('#eobRecreatePlanBenefitPackage').val(),
            "masterGroupNumber": jQuery('#eobRecreateMbrNo').val(),
            "memberMedicalId": jQuery('#eobRecreateMbrId').val(),
            "memberMedicalIdList":["5555665","33333"],
            "reportingPeriodEndDate": jQuery('#eobRecreateReportingPeriodEndDate').val()
        };

        jQuery.blockUI.defaults.overlayCSS.backgroundColor = '#C0C0C0';
        //jQuery('#eobRecreateResultContainer').block({ message: '<h1><img src="/etc/designs/spp-optum-design/spp-core-clientlibs/images/ajax-loader.gif" /> Loading...</h1>' });
        jQuery.ajax({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            //url: "/etc/designs/spp-optum-design/spp-core-clientlibs/mock-data/eob-recreate.json",
            url:"client-apps/dinesh/eob-recreate.json",
            cache: false,
            dataType: "json"
            //headers: { "Accept-Encoding" : "gzip" }
            //data: JSON.stringify({eobRecreateVO:requestJSON})
        })
        .done(function(data,textStatus,jqXHR) {
            if(jqXHR.status == 204) {
                jQuery('#eobRecreateSearchErrorMsg').text("No records were found that match your search criteria.  Please modify your search criteria and try again.").show();
            }    
            else if(jqXHR.status == 200) { 
                var subsCount = data["eobRecreateResponse"].subscriberCount;
                jQuery('#errorMsg').hide();
                jQuery('#tablejson').text(JSON.stringify(data));
                var responseJSON = data["eobRecreateResponse"].recreateVOList;
                eobRecreateSearch.displayResults(responseJSON);
            }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
        })
        .always(function() {
            //jQuery('#eobRecreateResultContainer').unblock();
        });
    },   // end: search
    displayResults:function(data){
        jQuery('#eobRecreateResultTab').dataTable().fnClearTable();
        var isArray = Object.prototype.toString.call(data) === '[object Array]';
        if(!isArray){
            data = [data];
        }
        jQuery('#eobRecreateDetailsContainer').show();
        jQuery('#eobRecreateResultTab').dataTable().fnAddData(data);
    }
};
jQuery('#selectall1').change(function(){
    if(jQuery(this).is(':checked')){
        jQuery( ".editor-active").prop('checked', true);
    }
    else{
        jQuery( ".editor-active").prop('checked', false);
    }
});
function postMethodss(){
    var oTable = jQuery('#eobRecreateResultTab').dataTable();
    var reqSerArr = [];
    $("input:checked", oTable.fnGetNodes()).each(function(i){
    var tds = jQuery(this).parent().parent().children('td');
      var oj =  "{\"ContractNumber\":" +tds.eq(2).text()+",\"mastergroupnumber\":"+tds.eq(3).text()+ "}";
      reqSerArr.push(oj);
    });
    console.log(reqSerArr);
}
function SubmitRecreateRequest(){
    var flag = true;
    if (  (jQuery("input.editor-active:checked").length == false ) ||  (jQuery("input.editor-active:checked").length < 1 ) )
    {
        flag = false;
        alert("Please Select the checkbox" + "  "+ jQuery("input.editor-active:checked").length);
        return false;
    }
    if( flag ){
        if(confirm("Do you want to submit the form ???")){
            // submitting info goes here.     
        }
    }
}


//Defining the EOB Results Data Table
jQuery("#eobRecreateResultTab").DataTable({
//"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>'
    "bJQueryUI" : true,
    "bProcessing" : true,
    "bSort": true,
    "scrollX": true,
    "scrollY": "200px",
    "bAutoWidth": true,
    "bPaginate" : false,
    "bFilter": false,
    "bDestroy": true,
    "bInfo": false,
    "aoColumns": [
        {"mData":"subscriberName",
        "mRender":function(data, type, full){
            return full.contractNbr + "," + full.memberMedicalId ;
        }
        },
        { "mData": "contractNbr" },
        { "mData": "planBenefitPackage" },
        { "mData": "masterGroupNumber" },
        { "mData": "memberMedicalId"},
        { "mData": "reportingPeriodEndDate"},
        { "mData": null,
        "render": function ( data, type, row, meta ) {
            if ( type === 'display' ) {
                return '<input type="checkbox" class="editor-active">';
            }
                return "";
            },
            className:"dt-body-center",
            "targets": 0, "orderable": false 
        }
        ] ,//,
        rowCallback: function ( row, data ) {
            // Set the checked state of the checkbox in the table
            $('input.editor-active', row).prop( 'disabled', data.masterGroupNumber=="" );
        },
        "fnServerParams": function (aoData) {     
            aoData.push({ "name": "cbox", "value": true});     
        }    
   });
jQuery( "input.editor-active").click(function(){
  var strlength = jQuery(this).parent().prev().prev().text().length;
  console.log( strlength);
  if( strlength > 0 && jQuery(this).is(':checked')){
      jQuery(this).prop("checked", true);
  }else if( strlength > 0 && !jQuery(this).is(':checked'))
  {
     jQuery(this).prop("checked", false);

  }else{
    jQuery(this).prop("checked", false);
  }
});
//Action need to perform when a row in results table selected.
//jQuery('#eobRecreateResultTab tbody').on( 'click', 'tr td:not(:last-child)', function () {
jQuery('#eobRecreateResultTab tbody').on( 'click', 'tr td:eq( jQuery('tr td:input'))', function () {

    if ( jQuery(this).hasClass('selected') ) {
        jQuery(this).removeClass('selected');
    }
    else {
        jQuery('tr.selected').removeClass('selected');
        jQuery(this).addClass('selected');
        jQuery('#eobRecreateDetailsContainer').slideDown("slow");
        var tr = jQuery(this).closest('tr');
        var selRow = $('#eobRecreateResultTab').DataTable().row( tr ).data();
        eobRecreateDetails.renderResults(selRow);
    }
});


// ##### Details Section #####
var eobRecreateDetails = {
    renderResults:function(data){
        jQuery('#eobRecreateDetailsTab').dataTable().fnClearTable();
        var isArray = Object.prototype.toString.call(data) === '[object Array]';
        if(!isArray){
            data = [data];
        }
        jQuery('#eobRecreateDetailsTab').dataTable().fnAddData(data);
    }
    // ,displayResults:function(){
    //     jQuery.ajax({
    //         type: "GET",
    //         contentType: "application/json; charset=utf-8",
    //         //url: "/spp-hapi/service/eob-recreate/getdetails/v1",
    //         url: "client-apps/dinesh/eob-recreate.json",
    //         cache: false,
    //         dataType: "json",
    //         //headers: { "Accept-Encoding" : "gzip" },
    //         data: JSON.stringify()
    //     })
    //     .done(function(data,textStatus,jqXHR) {
    //         if(jqXHR.status == 200) {
    //             var responseDetailsJSON = data["eobRecreateResponse"].recreateVOList;
    //             eobRecreateDetails.renderResults(responseDetailsJSON);
    //         }
    //     })
    //     .fail(function( jqXHR, textStatus, errorThrown ) {
    //     });    
    // }
};
jQuery('#eobRecreateDetailsContainer').slideUp("slow");
jQuery("#eobRecreateDetailsTab").dataTable({
    "bJQueryUI" : true,
    "bProcessing" : true,
    "bSort": true,
    "scrollX": true,
    "scrollY": "200px",
    "bAutoWidth": true,
    "bPaginate" : false,
    "bFilter": false,
    "bDestroy": true,
    "bInfo": false,
    "aoColumns": [
        { "mData": "sbscrReleaseId" },
        { "mData": "subscriberName" },
        { "mData": "memberMedicalId" },
        { "mData": "memberMedicalSourceSystem"},
        { "mData": "masterGroupNumber"},
        { "mData": "groupNumber"},
        { "mData": "divisionSite"},
        { "mData": "contractNbr"},
        { "mData": "planBenefitPackage"},
        { "mData": "planContractYear"},
        { "mData": "reportingPeriodEndDate"},
        { "mData": "EOBReleaseDate"},
        { "mData": "EligibilitySource"},
        { "mData": "SubscriberDOB"},
        { "mData": "claimIndicator"},
        { "mData": "recreateIndicator"},
        { "mData": "subscriberHolds"}
        ]
});
// ##### TRIGGER CLICK #####
jQuery(document).ready(function() {    
    var now = new Date();
    var first_day = new Date(now.getFullYear(), now.getMonth(), 1);
    var last_day = new Date(now.getFullYear(), now.getMonth(), 0);
    var lastDate = first_day.getMonth() + '/' + last_day.getDate() + '/' +  last_day.getFullYear();
    jQuery('#eobRecreateReportingPeriodEndDate').val(lastDate);
    
    jQuery("#eobRecreateSearchBtn").click(function(){
        //jQuery('#eobRecreateDetailsContainer').slideUp("slow");
        eobRecreateSearch.search();
    });
});
</script>





